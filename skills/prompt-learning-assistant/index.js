#!/usr/bin/env node

/**
 * Prompt Learning Assistant - 提示词工程学习助手
 *
 * 一个帮助用户系统化学习 AI 提示词工程的技能
 */

const fs = require('fs');
const path = require('path');

// 技能配置
const CONFIG = {
  name: 'Prompt Learning Assistant',
  version: '1.0.0',
  description: '系统化学习 58+ 种 AI 提示词技术'
};

// 知识库路径
const KNOWLEDGE_DIR = path.join(__dirname, 'knowledge');

/**
 * 主处理函数
 */
async function main() {
  const args = process.argv.slice(2);

  if (args.length === 0) {
    showHelp();
    return;
  }

  const command = args[0].toLowerCase();
  const query = args.slice(1).join(' ');

  switch (command) {
    case '学习':
    case 'learn':
      handleLearn(query);
      break;

    case '案例':
    case 'example':
      handleExample(query);
      break;

    case '路径':
    case 'path':
      handlePath(query);
      break;

    case '速查':
    case 'quick':
      handleQuick(query);
      break;

    case 'help':
    case 'h':
      showHelp();
      break;

    default:
      console.log(`❓ 未知命令: ${command}`);
      console.log('');
      showHelp();
  }
}

/**
 * 显示帮助信息
 */
function showHelp() {
  console.log(`
📚 Prompt Learning Assistant - 提示词工程学习助手

使用方法:
  学习 [关键词]    - 开始系统学习或搜索技术
  案例 [场景]      - 查看实战案例
  路径 [目标]      - 获取学习路径
  速查 [技术]      - 快速查询技术要点
  help             - 显示此帮助信息

示例:
  学习 提示词工程
  案例 写作
  路径 提高效率
  速查 Few-shot

版本: ${CONFIG.version}
`);
}

/**
 * 处理学习命令
 */
function handleLearn(query) {
  if (!query || query === '提示词工程') {
    showLearningOverview();
  } else {
    searchTechniques(query);
  }
}

/**
 * 显示学习概览
 */
function showLearningOverview() {
  console.log(`
📚 提示词工程学习系统

🎯 技术总数: 58+
📖 实战案例: 20+
🗺️ 学习路径: 个性化推荐

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🟢 入门级（8 种）- 必学基础
  角色扮演 | 逐步思考 | 示例驱动 | 结构化输出
  系统指令 | 任务分解 | 输出格式化 | 约束条件

🟡 进阶级（8 种）- 提升能力
  思维树 | 自我反思 | 对比分析 | 多角色辩论
  思维链优化 | 知识蒸馏 | 风格迁移 | 跨领域应用

🔴 专家级（8 种）- 高级技巧
  ReAct 推理 | Prompt Chaining | 思维图谱 | 元提示
  自适应提示 | 递归思考 | 集成学习 | 代理协作

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💡 使用 "学习 <关键词>" 搜索特定技术
💡 使用 "案例 <场景>" 查看实战案例
💡 使用 "路径 <目标>" 获取学习路径

开始你的学习之旅吧！ 🚀
`);
}

/**
 * 搜索技术
 */
function searchTechniques(query) {
  console.log(`
🔍 搜索结果: "${query}"

正在加载知识库...
（完整版需要订阅）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🎯 匹配技术:

1. 【入门】${getTechniquePreview(query)}
   💡 核心思想: ...
   📝 使用场景: ...
   ⚡ 快速示例: ...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🔓 解锁完整内容:
  💰 $19/月 - 访问全部 58+ 种技术
  💎 $49/季 - 季度优惠

输入 "路径 ${query}" 获取学习路径
`);
}

/**
 * 处理案例命令
 */
function handleExample(query) {
  console.log(`
💡 实战案例: "${query || '精选案例'}"

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📝 案例 1: 优化前后的对比

❌ 优化前:
  "帮我写一篇文章"

✅ 优化后 (使用 3 种技术):
  "你是一位专业的内容创作者。请按照以下要求写一篇关于 AI 提示词的文章：
  1. 目标读者: AI 初学者
  2. 风格: 通俗易懂，有实例
  3. 结构: 引言 -> 核心概念 -> 实战案例 -> 总结
  4. 字数: 800-1000 字

  请先列出大纲，我确认后再开始写作。"

使用技术:
  🎯 角色扮演
  📋 结构化输出
  🔄 逐步确认

效果提升:
  ✅ 目标明确
  ✅ 结构清晰
  ✅ 质量可控

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🔓 解锁更多案例:
  💰 订阅解锁 20+ 实战案例
  📦 每个案例包含: 优化前后对比 | 使用技术 | 效果分析

使用 "学习 <技术>" 查看技术详解
`);
}

/**
 * 处理路径命令
 */
function handlePath(query) {
  const goals = {
    '提高效率': `
🗺️ 学习路径: 提高工作效率

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

第 1 周: 基础入门
  ✅ 角色扮演 - 让 AI 进入角色
  ✅ 任务分解 - 拆解复杂任务
  ✅ 输出格式化 - 统一输出样式

第 2 周: 流程优化
  ✅ 逐步思考 - 引导 AI 推理
  ✅ 示例驱动 - 提供参考
  ✅ 约束条件 - 明确边界

第 3 周: 质量提升
  ✅ 结构化输出 - 模板化输出
  ✅ 自我反思 - 让 AI 自我检查
  ✅ 对比分析 - 多方案对比

第 4 周: 实战整合
  💡 综合 3-5 种技术解决实际问题
  💡 建立个人提示词库
  💡 持续优化和迭代

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📊 预期效果:
  ⚡ 工作效率提升 50-80%
  🎯 输出质量提升 40-60%
  🔄 AI 响应准确率提升 60-80%

💡 订阅后可追踪学习进度
`,
    '写作': `
🗺️ 学习路径: 提升写作能力

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

第 1 周: 基础技巧
  ✅ 角色扮演 - 设定写作人设
  ✅ 示例驱动 - 提供范文参考
  ✅ 风格迁移 - 学习不同风格

第 2 周: 内容优化
  ✅ 逐步思考 - 引导逻辑展开
  ✅ 结构化输出 - 规范文章结构
  ✅ 约束条件 - 控制字数和风格

第 3 周: 创意激发
  ✅ 多角度分析 - 拓展思路
  ✅ 对比分析 - 选择最优方案
  ✅ 自我反思 - 优化表达

第 4 周: 实战应用
  💡 创作 10 篇不同类型的文章
  💡 建立个人写作模板库
  💡 收集读者反馈优化

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📊 预期效果:
  ✍️ 写作速度提升 50%
  📈 内容质量显著提升
  🎯 创意多样性增加 40%

💡 订阅后可追踪学习进度
`
  };

  if (query && goals[query]) {
    console.log(goals[query]);
  } else {
    console.log(`
🗺️ 学习路径推荐

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

可用的学习路径:

🚀 提高工作效率
  路径 提高效率

✍️ 提升写作能力
  路径 写作

💻 优化编程效率
  路径 编程

📊 增强数据分析
  路径 数据分析

🎯 系统化学习
  路径 提示词工程

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💡 输入 "路径 <目标>" 获取详细学习路径
💡 订阅后可追踪学习进度
`);
  }
}

/**
 * 处理速查命令
 */
function handleQuick(query) {
  const techniques = {
    'few-shot': `
⚡ Few-shot (示例驱动) - 快速速查

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🎯 核心思想:
  通过提供示例，让 AI 理解你想要的输出模式

📝 使用场景:
  • 格式化输出
  • 风格化内容
  • 数据转换
  • 类型分类

⚡ 快速模板:
  "请按照以下示例完成任务:

  示例 1:
  输入: ...
  输出: ...

  示例 2:
  输入: ...
  输出: ...

  现在请处理: <你的输入>"

💡 提示:
  • 提供 2-5 个高质量示例
  • 示例要覆盖边界情况
  • 可以标注关键模式
`,
    'cot': `
⚡ Chain-of-Thought (逐步思考) - 快速速查

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🎯 核心思想:
  引导 AI 逐步推理，提高复杂任务的准确性

📝 使用场景:
  • 数学问题
  • 逻辑推理
  • 复杂决策
  • 问题分析

⚡ 快速模板:
  "请逐步思考并解决以下问题:

  1. 首先分析问题的核心
  2. 列出可能的解决方案
  3. 评估每个方案的优劣
  4. 给出最终建议

  问题: <你的问题>"

💡 提示:
  • 明确要求展示思考过程
  • 可以要求检查中间步骤
  • 适合复杂但不需推理速度的任务
`,
    'role': `
⚡ Role-playing (角色扮演) - 快速速查

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🎯 核心思想:
  为 AI 设定特定角色，让其以该角色的视角和风格响应

📝 使用场景:
  • 内容创作
  • 专业咨询
  • 语言风格转换
  • 情景模拟

⚡ 快速模板:
  "你现在是一位 <角色>。

  背景: <角色背景>
  风格: <说话风格>
  专业领域: <擅长领域>

  任务: <具体任务>

  请以 <角色> 的身份完成此任务。"

💡 提示:
  • 角色定义越具体越好
  • 可以结合历史人物、专业人士等
  • 适合需要特定风格或专业视角的任务
`
  };

  if (query) {
    const key = query.toLowerCase();
    if (techniques[key]) {
      console.log(techniques[key]);
    } else {
      console.log(`⚡ "${query}" - 技术速查

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🔓 订阅解锁此技术的完整速查卡

可用的免费速查:
  • 速查 Few-shot
  • 速查 COT
  • 速查 Role

💡 订阅解锁全部 58+ 种技术速查
`);
    }
  } else {
    console.log(`
⚡ 快速速查

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

可用技术速查:

🟢 免费技术:
  • 速查 Few-shot - 示例驱动
  • 速查 COT - 逐步思考
  • 速查 Role - 角色扮演

🔴 订阅解锁 58+ 种技术速查

使用方法:
  速查 <技术名称>

💡 输入 "学习" 查看完整技术列表
`);
  }
}

/**
 * 获取技术预览（占位函数）
 */
function getTechniquePreview(query) {
  // 这里应该从知识库文件中读取
  return '相关技术';
}

// 运行主函数
if (require.main === module) {
  main().catch(error => {
    console.error('❌ 错误:', error.message);
    process.exit(1);
  });
}

module.exports = {
  main,
  handleLearn,
  handleExample,
  handlePath,
  handleQuick
};
