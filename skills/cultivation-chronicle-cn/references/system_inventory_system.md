---
name: Managing Inventory System
description: 管理背包系统，包括道具获得、丢弃、查询，以及10件物品限制的处理
---

# 背包系统管理

## 功能说明

此 Skill 负责管理《问道笔录》游戏中的背包系统，包括：
- 玩家背包管理（最多10件道具）
- 队友背包管理（最多10件道具）
- 道具获得与丢弃
- 背包容量检查与自动处理
- 道具优先级排序

## 核心指令

### 1. 查询背包

读取 `game_state.md` 文件的"背包系统"部分。

**返回信息应包含**：
- 玩家背包：当前道具列表（数量/10）
- 队友背包：队友道具列表（数量/10）如有队友
- 每件道具的名称和描述

### 2. 获得道具

当玩家获得新道具时：

**步骤**：
1. 读取当前背包状态
2. 检查背包是否已满（10/10）
3. **如果背包未满**：
   - 直接添加道具到背包
   - 按重要性重新排序
   - 保存文件
4. **如果背包已满**：
   - 列出当前所有道具
   - 提示玩家：背包已满，需要丢弃一件道具才能获得新道具
   - 显示新道具信息
   - 询问玩家：要丢弃哪件道具？或者放弃获得新道具？
   - 等待玩家明确输入
5. **处理玩家选择**：
   - 如果玩家输入明确（道具名称或编号）→ 丢弃指定道具，获得新道具
   - 如果玩家输入不明确 → 警告并丢弃当前最不重要的道具
   - 如果玩家选择放弃 → 不获得新道具
6. 保存更新后的状态

### 3. 丢弃道具

玩家主动丢弃道具时：

**步骤**：
1. 读取当前背包
2. 确认道具是否存在
3. 删除指定道具
4. 重新排序剩余道具
5. 保存文件

### 4. 队友背包操作

队友背包操作与玩家背包类似，但有额外规则：

**添加道具到队友背包**：
1. 检查是否有队友
2. 如无队友，返回错误
3. 如有队友，按照玩家背包相同规则处理

**队友离队处理**：
1. 当收到 character_system 的队友离队通知
2. 清空队友背包所有道具
3. **重要**：这些道具永久丢失，需要警告玩家

### 5. 道具优先级排序

背包道具按重要性排序，优先级规则：

**最高优先级（不可轻易丢弃）**：
1. 前世传承物品（功法玉简、法宝、笔录）
2. 任务关键道具
3. 稀有功法玉简（玄阶以上）
4. 高阶法宝（灵阶以上）

**中等优先级**：
5. 破境丹药（用于突破境界）
6. 珍贵灵材
7. 重要信物（师父遗物、地图残片等）
8. 特殊道具（可触发剧情）

**较低优先级**：
9. 疗伤丹药（常见消耗品）
10. 普通符箓（消耗品）
11. 灵石（货币）
12. 普通材料

**自动丢弃逻辑**：
当玩家输入不明确时，丢弃当前优先级最低的道具。

## 道具类型与格式

### 道具类型

1. **功法玉简**
   - 格式：《功法名称》（品阶，额外说明）
   - 示例：《青云剑诀》（玄阶上品功法玉简，前世传承）

2. **法宝**
   - 格式：法宝名称（品阶，类型）
   - 示例：寒铁剑（灵阶法宝，陪伴多年的飞剑）

3. **丹药**
   - 格式：丹药名称×数量（用途说明）
   - 示例：筑基丹×3（用于突破筑基的珍贵丹药）

4. **灵材**
   - 格式：材料名称×数量（用途说明）
   - 示例：千年何首乌×1（炼制破境丹的主药）

5. **符箓**
   - 格式：符箓名称×数量（用途说明）
   - 示例：疗伤符×5（紧急疗伤之用）

6. **特殊道具**
   - 格式：道具名称（说明）
   - 示例：师父遗物（一块玉佩，似乎藏有秘密）

7. **货币**
   - 格式：灵石×数量（用途说明）
   - 示例：灵石×300（修炼和交易货币）

### game_state.md 中的背包格式

```markdown
## 背包系统

### 你的背包（6/10）

1. 青云剑诀（玄阶上品功法玉简，前世传承）
2. 寒铁剑（灵阶法宝，陪伴多年的飞剑）
3. 筑基丹×3（用于突破筑基的珍贵丹药）
4. 疗伤符×5（紧急疗伤之用）
5. 灵石×300（修炼和交易货币）
6. 师父遗物（一块玉佩，似乎藏有秘密）

### 队友背包（3/10）

1. 素女剑（灵阶法宝）
2. 养颜丹×10（保持容颜的丹药）
3. 防御符×8（防护法阵符箓）
```

## 使用场景

### 场景1：背包未满时获得道具

```
game_master 调用 inventory_system：
- 事件：玩家在秘境中发现《剑意心得》
- 请求：添加道具到背包

inventory_system 执行：
1. 读取背包：当前 6/10
2. 未满，直接添加
3. 插入合适位置（按优先级）：
   1. 青云剑诀（前世传承，最高优先级）
   2. 寒铁剑（法宝，高优先级）
   3. 剑意心得（新增，特殊道具，中高优先级）
   4. 筑基丹×3（丹药，中等优先级）
   5. 疗伤符×5（消耗品，较低优先级）
   6. 灵石×300（货币，较低优先级）
   7. 师父遗物（信物，中等优先级）
4. 更新数量：7/10
5. 保存文件

返回给 game_master：成功添加《剑意心得》到背包
```

### 场景2：背包已满时获得道具

```
game_master 调用 inventory_system：
- 事件：玩家击杀妖兽，获得妖丹×1
- 请求：添加道具到背包

inventory_system 执行：
1. 读取背包：当前 10/10（已满）
2. 检测到背包已满
3. 生成提示信息：

---

你获得了**妖丹×1**（炼丹珍贵材料，可用于炼制破境丹）

但你的背包已满（10/10），必须丢弃一件道具才能获得妖丹。

当前背包：
1. 青云剑诀（玄阶上品功法玉简，前世传承）
2. 寒铁剑（灵阶法宝）
3. 筑基丹×3（突破筑基丹药）
4. 疗伤符×5（疗伤消耗品）
5. 灵石×200（货币）
6. 师父遗物（玉佩，可能藏有秘密）
7. 妖兽皮×3（普通材料，可卖钱）
8. 破损地图（残缺不全的地图）
9. 玄铁矿×2（炼器材料）
10. 凡阶剑谱（凡阶功法，已过时）

你要丢弃哪件道具？
（输入道具编号或名称，或输入"放弃"不获得妖丹）

---

4. 等待玩家输入
```

**玩家输入明确**（例如："丢弃10"或"丢弃凡阶剑谱"）：
```
inventory_system 继续执行：
5. 识别玩家选择：丢弃"凡阶剑谱"
6. 删除该道具
7. 添加妖丹到背包
8. 重新排序
9. 保存文件

返回：你丢弃了"凡阶剑谱"，获得了"妖丹×1"
```

**玩家输入不明确**（例如："不要了"、"随便吧"、或无效输入）：
```
inventory_system 继续执行：
5. 识别为不明确输入
6. 警告：你的指令不明确，系统将自动丢弃最不重要的道具
7. 根据优先级判断：妖兽皮和凡阶剑谱优先级最低
8. 丢弃：凡阶剑谱
9. 添加妖丹到背包
10. 保存文件

返回：你丢弃了"凡阶剑谱"，获得了"妖丹×1"
```

**玩家选择放弃**（输入"放弃"或"不要"）：
```
inventory_system 继续执行：
5. 识别为放弃
6. 不做任何修改

返回：你放弃了妖丹，背包保持不变
```

### 场景3：队友离队导致背包丢失

```
character_system 通知 inventory_system：
- 事件：林清雪陨落
- 请求：处理队友背包

inventory_system 执行：
1. 读取队友背包：3件道具
2. 记录丢失物品列表：
   - 素女剑
   - 养颜丹×10
   - 防御符×8
3. 清空队友背包
4. 保存文件
5. 返回丢失物品列表

game_master 接收到丢失列表，生成剧情：
"清雪倒在血泊中，她的素女剑断成两截，背包中的丹药和符箓散落一地，很快被秘境的能量侵蚀殆尽..."
```

### 场景4：使用消耗品

```
game_master 调用 inventory_system：
- 事件：玩家在战斗中使用了3张疗伤符
- 请求：扣除道具数量

inventory_system 执行：
1. 读取背包：疗伤符×5
2. 扣除数量：5 - 3 = 2
3. 更新道具：疗伤符×2
4. 保存文件

返回：成功使用3张疗伤符，剩余2张
```

如果消耗完毕：
```
1. 疗伤符×2，使用3张
2. 不够，只能使用2张
3. 删除该道具（数量为0）
4. 保存文件

返回：使用了2张疗伤符（全部），疗伤符已用尽
```

### 场景5：道具合成或转换

```
game_master 调用 inventory_system：
- 事件：玩家使用3种灵材炼制成功筑基丹×1
- 请求：删除材料，添加丹药

inventory_system 执行：
1. 读取背包
2. 删除：
   - 千年何首乌×1
   - 紫灵芝×1
   - 朱砂×1
3. 添加：筑基丹×1
4. 重新排序
5. 保存文件

返回：成功炼制筑基丹，消耗3种灵材
```

## 注意事项

### 1. 容量限制严格执行
- 玩家和队友背包都严格限制10件
- 获得新道具前必须检查容量
- 不能"临时"超过容量

### 2. 道具堆叠规则
- 同类消耗品可以堆叠（疗伤符×5、灵石×300）
- 不同品质的同类道具不堆叠（筑基丹和破境丹分开）
- 装备和功法不堆叠（每把剑都是独立道具）

### 3. 丢弃确认机制
- 高价值道具丢弃前需要明确确认
- 前世传承物品不会被自动丢弃
- 任务关键道具应给予特殊保护

### 4. 队友背包独立性
- 队友背包与玩家背包完全独立
- 可以在两个背包间转移道具
- 队友离队会永久丢失其背包物品

### 5. 道具描述要清晰
- 每件道具都有简洁的用途说明
- 避免使用纯数值描述
- 用叙事性语言描述道具特点

### 6. 优先级判断灵活性
- 优先级规则是参考，不是绝对
- 要考虑当前剧情和角色需求
- 必要时可以询问玩家意见

## 与其他系统的协作

### 与 character_system 协作
- **功法学习**：需要消耗功法玉简
- **境界突破**：需要消耗破境丹
- **队友离队**：清空队友背包
- **队友招募**：初始化队友背包

### 与 game_master 协作
- **奇遇获得道具**：添加到背包
- **战斗消耗道具**：扣除数量
- **交易/任务**：道具增减
- **剧情触发**：检查是否拥有特定道具

### 与 biography_system 协作
- 获得重要道具时，记录到生平
- 失去珍贵道具时，记录到生平

## 道具示例库

### 功法类
- 《青云剑诀》（玄阶上品，剑修功法）
- 《素女心经》（玄阶中品，女修功法）
- 《血煞魔功》（玄阶上品，魔道功法）
- 《长春功》（灵阶下品，增寿功法）
- 《五雷正法》（天阶，传说中的雷法）

### 法宝类
- 寒铁剑（灵阶，飞剑）
- 素女剑（灵阶，飞剑）
- 八卦阵盘（玄阶，阵法法宝）
- 紫金葫芦（灵阶，炼丹法宝）
- 断江剑（天阶，杀伐至宝）

### 丹药类
- 疗伤丹（快速恢复伤势）
- 筑基丹（辅助筑基突破）
- 破境丹（辅助境界突破）
- 养颜丹（保持容颜）
- 辟谷丹（代替食物）

### 符箓类
- 疗伤符（紧急疗伤）
- 防御符（临时防护）
- 遁空符（瞬间移动）
- 传音符（远程通讯）
- 灭妖符（克制妖邪）

### 材料类
- 千年何首乌（珍贵灵材）
- 妖丹（妖兽内丹）
- 灵石（修炼货币）
- 玄铁矿（炼器材料）
- 朱砂（炼丹符箓材料）

### 特殊道具类
- 师父遗物（玉佩，隐藏秘密）
- 上古地图残片（指向秘境）
- 令牌（身份凭证）
- 笔录心得（前世感悟）
- 血书（仇家名单）

## 参考资料

详细的游戏设计文档请参考：`CLAUDE.md`

道具系统、背包管理、优先级规则等详细设定都在该文档中有完整说明。
